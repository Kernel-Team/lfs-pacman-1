pkgname=bash
_basever=4.4
_patchlevel=021
pkgver=${_basever}.${_patchlevel}
pkgrel=1
pkgdesc="The GNU Bourne Again shell"
arch=('x86_64')
url="https://www.gnu.org/software/bash/"
license=('GPL')
#depends=()
source=("https://ftp.gnu.org/gnu/bash/bash-${_basever}.tar.gz"
	"bash-config.patch"
	"bash.bashrc"
	"bash_logout"
	"bashrc"
	"profile")

if [ ! -z ${_patchlevel} ] && [ ${_patchlevel} -gt 0 ]
then
	for (( _p=1; _p <= $((10#${_patchlevel})); _p++ ))
	do
		source=(${source[@]} https://ftp.gnu.org/gnu/bash/bash-${_basever}-patches/bash${_basever//.}-$(printf "%03d" ${_p}))
	done
fi

prepare() {
	cd "${srcdir}/bash-${_basever}"

	for (( _p=1; _p <= $((10#${_patchlevel})); _p++ ))
	do
		patch -p0 -i ../bash${_basever//.}-$(printf "%03d" ${_p})
	done

	patch -Np1 -i "${srcdir}/bash-config.patch"
}

build() {
	cd "${srcdir}/bash-${_basever}"

	./configure --prefix=/usr \
		--without-bash-malloc \
		--with-installed-readline

	make
}

package() {
	cd "${srcdir}/bash-${_basever}"

	make install DESTDIR="${pkgdir}"

	rm -rf "${pkgdir}/bin/bashbug" "${pkgdir}/usr/share/man/man1/bashbug.1"

	ln -sfv bash "${pkgdir}/usr/bin/sh"
	ln -sfv bash.1 "${pkgdir}/usr/share/man/man1/sh.1"

	install -v -dm755 "${pkgdir}/etc/skel"

	install -v -m644 "${srcdir}/bash.bashrc" "${pkgdir}/etc/bash.bashrc"

	install -v -m644 "${srcdir}/bash_logout" "${pkgdir}/etc/skel/.bash_logout"
	install -v -m644 "${srcdir}/bashrc" "${pkgdir}/etc/skel/.bashrc"
	install -v -m644 "${srcdir}/profile" "${pkgdir}/etc/skel/.profile"

	sed -i "s#BUILD_DIR = .*#BUILD_DIR = /usr#g" "${pkgdir}/usr/lib/bash/Makefile.inc"
}

sha512sums=('73de3b425faaac55e45456b0f6f6d8077b5dfa7bb76e0d1894a19361b4a2b6bd4fbbe182117ddbfe9b07b4d898fba03537c261badc9533dd3c0da891764c7f29'
            'e244b388f1ecb9bc86ed6a53a4aca0aadfea4a19f9b40e4848b8d04e41b9c4c808ad5496d01c93a8b63f4d5345ee1093c7064f1b5107d426b2b27aecc403e0d3'
            '22a0383de775db663bf06445c0613b4ccb36af3149a3b3b1c8a2ed8727dfe35d84a2aaefc5c68807f084d00f238f7d3df88554e909657e321c16151a47c9e366'
            '849d2370570cac4446ebd94594d0de98f69781156a0a4f6d0f480fe6d5ab61b1e9459ade247de7ca76d9d9f668dec2abd81a2c1ac75ccadbe639d45706883b67'
            'c1cba90698d09bb7b20e0aedc6aa6cdcbd66b239e41c3a8c33456d56b91980736ed2acab40db98a215f9cc9b7ba66709a637760b9696f40b215bbbd5c11d8561'
            '1e0aa37f785d0beb3172e47a6a38887e6fdbbfbeb4f0a8033e44b5f02e9dde627195df64c503cbd644cb85c2681daeaf820b2a0d3dbafebf08e8683a39e1df8d'
            'fa7a1b277eb3bad6ae7d2c7a2887cbf2c0eb75b7fee8ed03ec1e9d45879a2fb4b8c7cb16d6b029987493b01a461214bd9a24454a6837e7cfe180b1bc56f61caa'
            '526f986057810f89080e283ff95b3a8fd24d37e4ad2f18c39f36d3a2d57956a6441d16220082157735e3c5ccf770d5016e761aa5f309129898e39277d576e6b5'
            'e61db89bdd1a7ae15013fe258046a343c9ea41e5a1c6d2c810947500a617fce7536b8d51194e14bb42499fe0de6d70cc9b2c81da0afdcb5a2278459f4f76d748'
            '7570cf15518f79230cfe91b3e58c795c16c7fb6ba6418d967355b36fb7982e7919a9eaaef9177fb605c7fb7d7efb8a8335e725c1bacffff69a098433f5adc9c7'
            '7546a6c90c8e8508567dde713722291477ca87c1116905b46432514a4fc632840a855b84f102591914cd4c44d5bf2eb7400866e26366fc94525fb401ea844a8f'
            '5edcd76cf97bfe289f71924ba279ff48a1167eb3cc36f811cbcc23732746f5c821d1d39d4b137b7d99d57809a4b7270a54f4a41176fcfde0708bf92ddc68b77f'
            '386c019debee414697abc648d9a77894e842bb0b7a2a71709e8b3398582f25065e68963405fa22fb77439c6b431ee94a2ecbb16734c2436af3dfb4d1b5f06fcf'
            'd9a8924f1c9263deab89153bb688a87f211913ebd72c8077e607db6fdddc7e5af05042dd22a9a2df593e518ea74b54ca79d20afc796e47d871827a2556e233d0'
            '3b01c080cf4a54658679b36c282a69a9ac48b900b19ceb42dbaf084abd395d50e5ff14db90a7fdf0c9856dad150897dca561160686c931634765782447fc076e'
            '54ff556b62fd88381e7a495db50957b016474973b3a566661c65b649a40960f2d3355221b3a71fb292128aad92a45d73d9816d63833bc416b4d15acdef391b98'
            '6b5b068b74978fc691749ccff5e094c768047f702430e97114f5bf342f078696f7d7616d0642d4061b062e9112dfe00a1c2309c65de4147e0e98fb52c593d844'
            '4661c4c132f2ea7c9a70368301041c482d5820d8389334a7e3ae44c36fc16c171b20db2f194b7663c84d6c3dcef81aa90f050a48e205218fc7bd3395d09c6a51'
            'eac0a9abf59b65a59a0028d2f3c0a7dc8a0b3c04e2d2db642b69aa7c13a2dfa190f3c63f7d8a7c9400f01701e9ef84212ce668c4c44d0ccfd02cd1f8e723d831'
            '11e16896aa66a1eafb12cdcea00515132789690e914c8894caefd8c80ed98c8e732428348ddbfb53495164ce4044596f5cdbc03e146dce364fc497f362a1859b'
            '94d6fed30d4a376c29f8986d15f1b3fd65a04ee0f3d1844d010f3e51a2f9f875cd294a68fb6f0e1ffa481fb09f02055b21f2f298ebd9d88eb2f76d6c1f15de34'
            '5acc704df3fe63b5b8055ba7bc14ae70cc23d15aefee8db6991e6c11cc8b0e10fcc67d516bc2d2fde84be26ed5c88dbf266fa164756218b60eccc2bfb4eed7d9'
            'c1d50aee953427ba0b95e48c10d2324e7413f3354ff65b9c3c1dfd14eedec55e619fcd12353e7b99b6e280f510e04d1c971b309c1a4efb97d48ddb30d69f14ac'
            '008ff44dbf916414d691c29cee29e7f636bbe79170463d76ef16ca63ecdc24a84ff4476078c28fb8788d9b1fb0572612a7e8cb30fceb55ad650f293db8361ad1'
            '59984e221a7a6dbf72bf893b1b7c4a63fea34d6af1208a19f0e9e6cd59a09e4cf51890cb2d31c1502e2a2f644f584417bb59cf02c308d3250d2a98d41b63e893'
            'e200fddd717fa33d2c56eb6713031d34891e5ebcd489a65a43ccfebf9728c1609b758ca3dffb1eed4abd3c62c6d7163ce88d8a1bb73b6d07bee99e0409365978'
            '43a82d06a17bc30c2579a0944cb68f60bd9e3cddb9fff4a760fbf1f2f5104a99bb69c400cf63231b242c03a4684701455e603d96c9b588f2c69da02570042fec')

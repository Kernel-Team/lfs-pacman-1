pkgname=ca-certificates
pkgver=20180409
pkgrel=1
pkgdesc="Common CA certificates"
arch=('x86_64')
url="https://packages.debian.org/source/sid/ca-certificates"
license=('GPL2' 'MPL')
#depends=()
options=(emptydirs)
install=ca-certificates.install
source=("http://http.debian.net/debian/pool/main/c/ca-certificates/ca-certificates_${pkgver}.tar.xz")

build() {
	cd "${srcdir}/ca-certificates" #-${pkgver}"

	sed -i "s#openssl rehash#c_rehash#g" sbin/update-ca-certificates

	make -j1
}

package() {
	cd "${srcdir}/ca-certificates" #-${pkgver}"

	install -v -dm755 "${pkgdir}/etc/ca-certificates/update.d" \
		"${pkgdir}/etc/ssl/certs" \
		"${pkgdir}/usr/sbin" \
		"${pkgdir}/usr/share/ca-certificates"

	make -j1 install DESTDIR="${pkgdir}"

	install -v -Dm644 sbin/update-ca-certificates.8 \
		"${pkgdir}/usr/share/man/man8/update-ca-certificates.8"

(
echo "# Automatically generated by ca-certificates-${VER}"
echo "# see update-ca-certificates man page"
echo "# "
cd "${pkgdir}/usr/share/ca-certificates"
find . -name '*.crt' | sort | cut -b3-
) > "${pkgdir}/etc/ca-certificates.conf"
}

sha512sums=('e0742da19416d367618547107cc0f1cc045d5ba62c30fb7238e0e36ec0d19ea48e2ffdee2c68a9f06954025c58db9a5376f149e221ede95a3a029cda39d86a53')

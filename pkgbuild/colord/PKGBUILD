pkgname=colord
pkgver=1.4.2
pkgrel=1
pkgdesc="System daemon for managing color devices"
arch=('x86_64')
url="https://www.freedesktop.org/wiki/Software/colord/"
license=('GPL2')
#depends=()
options=(emptydirs)
source=("https://www.freedesktop.org/software/colord/releases/colord-${pkgver}.tar.xz"
	"colord.sysusers")

prepare() {
	install -v -dm755 "${srcdir}/build"
}

build() {
	cd "${srcdir}/build"

	meson --prefix /usr \
		--sysconfdir /etc \
		--localstatedir /var \
		--buildtype=plain \
		-Denable-bash-completion=false \
		-Denable-argyllcms-sensor=false \
		-Denable-vala=true \
		-Denable-tests=false \
		-Dwith-daemon-user="colord" \
		"${srcdir}/colord-${pkgver}"

	ninja ${MAKEFLAGS}
}

package() {
	cd "${srcdir}/build"

	DESTDIR="${pkgdir}" ninja install

	install -v -Dm644 "${srcdir}/colord.sysusers" "${pkgdir}/usr/lib/sysusers.d/colord.conf"

	chown -R 71:71 "${pkgdir}/var/lib/colord"
}

sha512sums=('5dc276d008dd7e3365a894d8d8779e27bc0bb24c4eb9ec0994528da7fa92bff789993b0bfc075a443da664a781d23f9718e7eafc593acad80200b976266e2840'
            '46d421c626bf135b5cb2c491f3090b15bde6b4a06e5400ccea1e6d455c3fd406364555e34bfdeafac40072d9e64c1a9d9feb07d3dbac8594e83182f5b38eecf8')

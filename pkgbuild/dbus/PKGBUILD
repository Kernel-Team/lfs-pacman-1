pkgname=dbus
pkgver=1.10.16
pkgrel=1
pkgdesc="Freedesktop.org message bus system"
arch=('x86_64')
url="https://wiki.freedesktop.org/www/Software/dbus/"
license=('GPL' 'custom')
#depends=()
source=("https://dbus.freedesktop.org/releases/dbus/dbus-${pkgver}.tar.gz")

build() {
	cd "${srcdir}/dbus-${pkgver}"

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--enable-systemd \
		--enable-user-session \
		--with-console-auth-dir=/run/console/ \
		--with-systemdsystemunitdir=/lib/systemd/system

	make
}

package() {
	cd "${srcdir}/dbus-${pkgver}"

	make install DESTDIR="${pkgdir}"

	rm -rf "${pkgdir}/var/run"

	install -v -dm755 "${pkgdir}/lib"

	mv -v "${pkgdir}"/usr/lib/libdbus-1.so.* "${pkgdir}/lib"
	ln -sfv ../../lib/$(readlink "${pkgdir}/usr/lib/libdbus-1.so") "${pkgdir}/usr/lib/libdbus-1.so"

	ln -sfv /etc/machine-id "${pkgdir}/var/lib/dbus"
}

md5sums=('7f06c43736874c1ff50ae20392955511')

pkgname=docbook-xml
pkgver=4.5
pkgrel=1
pkgdesc="A widely used XML scheme for writing documentation and help"
arch=('x86_64')
url="http://www.oasis-open.org/docbook/"
license=('MIT')
#depends=()
install=docbook-xml.install
source=("http://www.docbook.org/xml/4.5/docbook-xml-4.5.zip"
	"http://www.docbook.org/xml/4.4/docbook-xml-4.4.zip"
	"http://www.docbook.org/xml/4.3/docbook-xml-4.3.zip"
	"http://www.docbook.org/xml/4.2/docbook-xml-4.2.zip"
	"http://www.docbook.org/xml/4.1.2/docbkx412.zip")
noextract=("docbook-xml-4.5.zip" "docbook-xml-4.4.zip" "docbook-xml-4.3.zip" "docbook-xml-4.2.zip" "docbkx412.zip")

package() {
	install -v -dm755 "${srcdir}/install"

	cd "${srcdir}/install"

	install -v -dm755 "${pkgdir}/etc/xml"
	xmlcatalog --noout --create "${pkgdir}/etc/xml/docbook-xml"

	for BOOKVER in 4.1.2 4.2 4.3 4.4 4.5
	do
		if [ ${BOOKVER} == "4.1.2" ]
		then
			export ZIP="docbkx412.zip"
		else
			export ZIP="docbook-xml-${BOOKVER}.zip"
		fi

 		bsdtar xf "${srcdir}/${ZIP}"

		install -v -dm755 ${pkgdir}/usr/share/xml/docbook/xml-dtd-${BOOKVER}
		cp -rf docbook.cat *.dtd ent *.mod ${pkgdir}/usr/share/xml/docbook/xml-dtd-${BOOKVER}

		rm -rf *

		xmlcatalog --noout --add "public" \
			"-//OASIS//DTD DocBook XML V${BOOKVER}//EN" \
			"http://www.oasis-open.org/docbook/xml/${BOOKVER}/docbookx.dtd" \
			"${pkgdir}/etc/xml/docbook-xml"

		xmlcatalog --noout --add "public" \
			"-//OASIS//DTD DocBook XML CALS Table Model V${BOOKVER}//EN" \
			"http://www.oasis-open.org/docbook/xml/${BOOKVER}/calstblx.dtd" \
			"${pkgdir}/etc/xml/docbook-xml"

		xmlcatalog --noout --add "public" \
			"-//OASIS//DTD XML Exchange Table Model 19990315//EN" \
			"http://www.oasis-open.org/docbook/xml/${BOOKVER}/soextblx.dtd" \
			"${pkgdir}/etc/xml/docbook-xml"

		xmlcatalog --noout --add "public" \
			"-//OASIS//ELEMENTS DocBook XML Information Pool V${BOOKVER}//EN" \
			"file:///usr/share/xml/docbook/xml-dtd-${BOOKVER}/dbpoolx.mod" \
			"${pkgdir}/etc/xml/docbook-xml"

		xmlcatalog --noout --add "public" \
			"-//OASIS//ELEMENTS DocBook XML Document Hierarchy V${BOOKVER}//EN" \
			"http://www.oasis-open.org/docbook/xml/${BOOKVER}/dbhierx.mod" \
			"${pkgdir}/etc/xml/docbook-xml"

		xmlcatalog --noout --add "public" \
			"-//OASIS//ENTITIES DocBook XML Additional General Entities V${BOOKVER}//EN" \
			"http://www.oasis-open.org/docbook/xml/${BOOKVER}/dbgenent.mod" \
			"${pkgdir}/etc/xml/docbook-xml"

		xmlcatalog --noout --add "public" \
			"-//OASIS//ENTITIES DocBook XML Notations V${BOOKVER}//EN" \
			"http://www.oasis-open.org/docbook/xml/${BOOKVER}/dbnotnx.mod" \
			"${pkgdir}/etc/xml/docbook-xml"

		xmlcatalog --noout --add "public" \
			"-//OASIS//ENTITIES DocBook XML Character Entities V${BOOKVER}//EN" \
			"file:///usr/share/xml/docbook/xml-dtd-${BOOKVER}/dbcentx.mod" \
			"${pkgdir}/etc/xml/docbook-xml"

		xmlcatalog --noout --add "rewriteSystem" \
			"http://www.oasis-open.org/docbook/xml/${BOOKVER}" \
			"file:///usr/share/xml/docbook/xml-dtd-${BOOKVER}" \
			"${pkgdir}/etc/xml/docbook-xml"

		xmlcatalog --noout --add "rewriteURI" \
			"http://www.oasis-open.org/docbook/xml/${BOOKVER}" \
			"file:///usr/share/xml/docbook/xml-dtd-${BOOKVER}" \
			"${pkgdir}/etc/xml/docbook-xml"

		if [ ${BOOKVER} == "4.3" ] || [ ${BOOKVER} == "4.4" ] || [ ${BOOKVER} == "4.5" ]
		then
			xmlcatalog --noout --add "public" \
				"-//OASIS//ELEMENTS DocBook XML HTML Tables V${BOOKVER}//EN" \
				"http://www.oasis-open.org/docbook/xml/${BOOKVER}/htmltblx.mod" \
				"${pkgdir}/etc/xml/docbook-xml"
		fi
	done
}

md5sums=('03083e288e87a7e829e437358da7ef9e'
         'cbb04e9a700955d88c50962ef22c1634'
         'ab200202b9e136a144db1e0864c45074'
         '73fe50dfe74ca631c1602f558ed8961f'
         '900d7609fb7e6d78901b357e4acfbc17')

pkgname=ffmpeg
pkgver=3.3.4
pkgrel=1
pkgdesc="Complete solution to record, convert and stream audio and video"
arch=('x86_64')
url="http://www.ffmpeg.org/"
license=('GPL3')
#depends=()
source=("http://www.ffmpeg.org/releases/ffmpeg-${pkgver}.tar.xz"
	"ffmpeg-openjp2.patch")

prepare() {
	cd "${srcdir}/ffmpeg-${pkgver}"

	sed -i "s: -lstdc++::g" configure
	patch -Np1 -i "${srcdir}/ffmpeg-openjp2.patch"
}

build() {
	cd "${srcdir}/ffmpeg-${pkgver}"

	./configure --prefix=/usr \
		--enable-chromaprint \
		--enable-gpl \
		--enable-libass \
		--enable-libbluray \
		--enable-libcdio \
		--enable-libfdk-aac \
		--enable-libfontconfig \
		--enable-libfreetype \
		--enable-libfribidi \
		--enable-libmp3lame \
		--enable-libopenjpeg \
		--enable-libopus \
		--enable-libpulse \
		--enable-librtmp \
		--enable-libsoxr \
		--enable-libspeex \
		--enable-libssh \
		--enable-libtheora \
		--enable-libv4l2 \
		--enable-libvo-amrwbenc \
		--enable-libvorbis \
		--enable-libvpx \
		--enable-libwavpack \
		--enable-libwebp \
		--enable-libx264 \
		--enable-libx265 \
		--enable-libxvid \
		--enable-nonfree \
		--enable-openal \
		--enable-opencl  \
		--enable-opengl \
		--enable-openssl \
		--enable-postproc \
		--enable-shared \
		--enable-vaapi \
		--enable-vdpau \
		--enable-version3 \
		--disable-debug \
		--disable-static \
		--extra-cflags="${CFLAGS}" \
		--extra-cxxflags="${CXXFLAGS}" \
		--cc="${CC}" --cxx="${CXX}"

	make
}

package() {
	cd "${srcdir}/ffmpeg-${pkgver}"

	make install DESTDIR="${pkgdir}"
}

sha512sums=('ddeab4ab3d149a1b560c8ad2242f8ea5fb37a57a06a5af1adf6d5afde9975aa4b2d72f7c5106f20d2194b546164f55f93f6b3d1bb784501b842b0eae89a6a691'
            'd3f3bd2a1f7709792b0af1fcd582b54cdf9d7c87ff0a0f4f29ba8e5aeaa35b02e103010e1091c897f5ad69c5c5247875c2f061798945d8271c0665687ac919cf')

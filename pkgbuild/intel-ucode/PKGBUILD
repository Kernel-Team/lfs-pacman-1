pkgname=intel-ucode
_dlid=27945
pkgver=20180703
pkgrel=1
pkgdesc="Microcode update files for Intel CPUs"
arch=('x86_64')
url="https://downloadcenter.intel.com/SearchResult.aspx?lang=eng&keyword=%22microcode%22"
license=('custom')
#depends=()
source=("https://downloadmirror.intel.com/${_dlid}/eng/microcode-${pkgver}.tgz")

build() {
	cd "${srcdir}"

	rm -rfv intel-ucode/list intel-ucode-with-caveats/list
	install -v -dm755 kernel/x86/microcode
	iucode_tool -w kernel/x86/microcode/GenuineIntel.bin intel-ucode/ intel-ucode-with-caveats/
	echo kernel/x86/microcode/GenuineIntel.bin | bsdcpio -o -H newc -R 0:0 > intel-ucode.img
}

package() {
	cd "${srcdir}"

	install -v -Dm644 intel-ucode.img "${pkgdir}/boot/intel-ucode.img"
}

sha512sums=('25af4158f97fba2fb88f05a44f42ed7d2415001ccc58f573d366f405ff198472517468f619628f4f6e5a371793c41ea8faf5a932d2362b2a51726bb5c84e0eed')

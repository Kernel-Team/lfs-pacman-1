pkgname=intel-ucode
_dlid=28087
pkgver=20180807.a
pkgrel=1
pkgdesc="Microcode update files for Intel CPUs"
arch=('x86_64')
url="https://downloadcenter.intel.com/SearchResult.aspx?lang=eng&keyword=%22microcode%22"
license=('custom')
#depends=()
source=("https://downloadmirror.intel.com/${_dlid}/eng/microcode-${pkgver/./}.tgz")

build() {
	cd "${srcdir}"

	rm -rfv intel-ucode/list intel-ucode-with-caveats/list
	install -v -dm755 kernel/x86/microcode
	iucode_tool -w kernel/x86/microcode/GenuineIntel.bin intel-ucode/ intel-ucode-with-caveats/
	echo kernel/x86/microcode/GenuineIntel.bin | bsdcpio -o -H newc -R 0:0 > intel-ucode.img
}

package() {
	cd "${srcdir}"

	install -v -Dm644 intel-ucode.img "${pkgdir}/boot/intel-ucode.img"
}

sha512sums=('3cd6794a5ce26e86f7b644e523ba978699316046e593da215b73b17c4b43049ac4a81636e2ce3e727d06c2efbac98657764aa3ff355edb429127585bb49a9b10')

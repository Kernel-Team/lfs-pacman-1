pkgname=linux-api-headers
_basever=4.12
pkgver=4.12.8
pkgrel=1
pkgdesc="Kernel headers sanitized for use in userspace"
arch=('x86_64')
url="https://www.gnu.org/software/libc/"
license=('GPL2')
source=("https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-${_basever}.tar.xz"
	"https://cdn.kernel.org/pub/linux/kernel/v4.x/patch-${pkgver}.xz")

prepare() {
	cd "${srcdir}/linux-${_basever}"
	[ ${_basever} != ${pkgver} ] && patch -Np1 -i "${srcdir}/patch-${pkgver}" || true
}

build() {
	cd "${srcdir}/linux-${_basever}"

	make mrproper
	make headers_check
}

package() {
	cd "${srcdir}/linux-${_basever}"

	make headers_install INSTALL_HDR_PATH="${pkgdir}/usr"

	rm -rf "${pkgdir}/usr/include/drm"

	find "${pkgdir}/usr/include" \( -name .install -o -name ..install.cmd \) -delete
}

sha512sums=('8e81b41b253e63233e92948941f44c6482acb52aa3a3fd172f03a38a86f2c35b2ad4fd407acd1bc3964673eba344fe104d3a03e3ff4bf9cd1f22bd44263bd728'
            '44e2417fe1379977b4891f74b227c2c6d6588f3726b598ad8c8a52ecaea32f56cf222b877230fc87c043583a6f230f3044fe3c9b293c67699e1743c0161004cf')

pkgname=mozjs
pkgver=24.2.0
pkgrel=1
pkgdesc="JavaScript interpreter and libraries"
arch=('x86_64')
url="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Releases/24"
license=(MPL)
#depends=()
source=("https://ftp.mozilla.org/pub/mozilla.org/js/mozjs-${pkgver}.tar.bz2")

prepare() {
	cd "${srcdir}/mozjs-${pkgver}/js/src"

	sed -i "s:defined(@TEMPLATE_FILE):@TEMPLATE_FILE:g" config/milestone.pl
}

build() {
	cd "${srcdir}/mozjs-${pkgver}/js/src"

	export CC="gcc"
	export CXX="g++"
	export SHELL="/bin/bash"

	./configure --prefix=/usr \
		--enable-readline \
		--enable-threadsafe \
		--with-system-ffi \
		--with-system-nspr \

	make
}

package() {
	cd "${srcdir}/mozjs-${pkgver}/js/src"

	make install DESTDIR="${pkgdir}"

	find "${pkgdir}/usr/include" -type f -exec chmod 644 {} \;
	find "${pkgdir}/usr/lib/pkgconfig" -type f -exec chmod 644 {} \;
}

md5sums=('5db79c10e049a2dc117a6e6a3bc78a8e')

pkgname=mozjs52
pkgver=52.2.1
pkgrel=1
pkgdesc="JavaScript interpreter and libraries - Version 52"
arch=('x86_64')
url="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Releases/52"
license=('MPL')
#depends=()
source=("https://people.mozilla.org/~sstangl/mozjs-${pkgver}.rc0.tar.bz2"
	"mozjs-fixes.patch")

source=("https://download.gnome.org/teams/releng/tarballs-needing-help/mozjs/mozjs-${pkgver}gnome1.tar.gz")

build() {
	cd "${srcdir}/mozjs-${pkgver}gnome1/js/src"

	export CC="gcc"
	export CXX="g++"
	export PYTHON="/usr/bin/python"
	export SHELL="/bin/bash"

	./configure --prefix=/usr \
		--enable-readline \
		--with-intl-api \
		--with-system-icu \
		--with-system-nspr \
		--with-system-zlib

	make
}

package() {
	cd "${srcdir}/mozjs-${pkgver}gnome1/js/src"

	make install DESTDIR="${pkgdir}"

	rm -rf "${pkgdir}/usr/lib/libjs_static.ajs"

	find "${pkgdir}/usr/include" -type f -exec chmod 644 {} \;
	find "${pkgdir}/usr/lib/pkgconfig" -type f -exec chmod 644 {} \;
}

sha512sums=('3013061d2a79a5a4d2765f6058dac2b7a216faec0812d7b39f5cbc34ef4cd282b9fbf418023ecf0518e1ef5c7b8ad4328b87314cc10a9ac1141c844001f826d9')

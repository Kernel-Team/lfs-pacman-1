pkgname=networkmanager
pkgver=1.8.4
pkgrel=1
pkgdesc="Network connection manager and user applications"
arch=('x86_64')
url="https://wiki.gnome.org/Projects/NetworkManager"
license=('GPL2' 'LGPL2.1')
_pppver=2.4.7
#depends=()
options=(emptydirs)
source=("https://download.gnome.org/sources/NetworkManager/${pkgver:0:3}/NetworkManager-${pkgver}.tar.xz"
	"NetworkManager.conf"
	"NetworkManager.tmpfiles")

build() {
	cd "${srcdir}/NetworkManager-${pkgver}"

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--disable-ld-gc \
		--disable-qt \
		--enable-gtk-doc \
		--with-config-dhcp-default=dhclient \
		--with-dhclient=/usr/sbin/dhclient \
		--with-pppd-plugin-dir=/usr/lib/pppd/${_pppver} \
		--with-session-tracking=systemd \
		--with-suspend-resume=systemd \
		--with-systemdsystemunitdir=/usr/lib/systemd/system \
		--with-udev-dir=/usr/lib/udev

	sed -i "s#none required#-ldl#g" $(grep -rl "none required")

	make
}

package() {
	cd "${srcdir}/NetworkManager-${pkgver}"

	make install DESTDIR="${pkgdir}"

	rm -rf "${pkgdir}/lib/systemd/system/network-online.target.wants" "${pkgdir}/var/run"

	install -v -Dm644 "${srcdir}/NetworkManager.conf" "${pkgdir}/etc/NetworkManager/NetworkManager.conf"
	install -v -Dm644 "${srcdir}/NetworkManager.tmpfiles" "${pkgdir}/usr/lib/tmpfiles.d/NetworkManager.conf"
}

sha512sums=('e9aa26e2abe4537c6cbba53e281493e32be8a9f0624d5323212848f286d1279ad2ab79a39de34ad0ea188c888b1b61c4ba4d4d053c4d227e68f9236955f69bb1'
            '1f4e6c09da5a8921ee7759861cfa5e808c64cd27e733cd62cfb35776db05a226a73443c071730035480c9ba4abe85fa7daeb14aeffbbdae20ed193d78341f451'
            '61ce398a21f1cadb0e1d29dc4a1254d23153a637ae500e884e1fb8a043c06d5f9f765b8d941a8bbf12bfa3fbada8ace6d0420c4ded82833bff9eaa7978eddc01')

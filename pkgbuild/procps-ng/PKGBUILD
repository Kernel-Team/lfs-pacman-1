pkgname=procps-ng
pkgver=3.3.12
pkgrel=1
pkgdesc="Utilities for monitoring your system and its processes"
arch=('x86_64')
url="https://gitlab.com/procps-ng/procps"
license=('GPL' 'LGPL')
#depends=()
source=("https://downloads.sourceforge.net/procps-ng/procps-ng-${pkgver}.tar.xz"
	"99-procps.conf")

build() {
	cd "${srcdir}/procps-ng-${pkgver}"

	sed -i "s:ncursesw/::g" watch.c

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--sbindir=/sbin \
		--enable-watch8bit

	make
}

package() {
	cd "${srcdir}/procps-ng-${pkgver}"

	make install DESTDIR="${pkgdir}"

	install -v -dm755 "${pkgdir}/bin" "${pkgdir}/lib" "${pkgdir}/usr/lib/sysctl.d"

	install -v -m644 "${srcdir}/99-procps.conf" "${pkgdir}/usr/lib/sysctl.d"

	mv -v "${pkgdir}"/usr/bin/{kill,pidof,ps} "${pkgdir}/bin"

	mv -v "${pkgdir}"/usr/lib/libprocps.so.* "${pkgdir}/lib"
	ln -sfv ../../lib/$(readlink "${pkgdir}/usr/lib/libprocps.so") "${pkgdir}/usr/lib/libprocps.so"
}

md5sums=('957e42e8b193490b2111252e4a2b443c'
         'dac3e52469ebb46eeb63a2fdcea341b9')

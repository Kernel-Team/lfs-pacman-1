pkgname=v4l-utils
pkgver=1.12.6
pkgrel=1
pkgdesc="Userspace tools and conversion library for Video 4 Linux"
arch=('x86_64')
url="https://linuxtv.org/"
license=('LGPL')
#depends=()
source=("https://linuxtv.org/downloads/v4l-utils/v4l-utils-${pkgver}.tar.bz2")

prepare() {
	cd "${srcdir}/v4l-utils-${pkgver}"

	sed -i "/SUBDIRS/s# ir-ctl##g" utils/Makefile.in

	sed -i "/unistd.h/i#include <time.h>" utils/cec-compliance/cec-test-power.cpp \
		utils/cec-compliance/cec-test-audio.cpp \
		utils/cec-follower/cec-processing.cpp \
		utils/rds-ctl/rds-ctl.cpp
}

build() {
	cd "${srcdir}/v4l-utils-${pkgver}"

	export CXX="${CXX} -std=c++11"

	./configure --prefix=/usr --sysconfdir=/etc

	make
}

package() {
	cd "${srcdir}/v4l-utils-${pkgver}"

	make -j1 install DESTDIR="${pkgdir}"

	rm -rf "${pkgdir}/usr/bin/ivtv-ctl"
}

sha512sums=('1f6e7ba9513ea836d6536eaf2f148588e9a2beaab62c49fb295e60aae41382781f76d536e854bbe6fc601f00034e3239b551874dc99a1f6afa788ee94976b332')
